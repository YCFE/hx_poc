{"version":3,"sources":["../../src/runtime/build.js"],"names":["generateBuildImpl","configPath","webpackModifyImpl","webpackConfig","workingDir","dirname","jsapiContextDir","resolve","rpcContextDir","useContext","jsapi","rpc","lstatSync","isDirectory","ex","plugins","unshift","DefinePlugin","__KYLIN_PLUGIN_LUNA_MOCK_CONFIG__","JSON","stringify","__KYLIN_PLUGIN_LUNA_MOCK_WORKING_DIR__","__KYLIN_PLUGIN_LUNA_MOCK_CONTEXT_JSAPI__","__KYLIN_PLUGIN_LUNA_MOCK_CONTEXT_RPC__"],"mappings":";;;;;kBAIwBA,iB;;AAJxB;;;;AACA;;;;AACA;;;;;;AAEe,SAASA,iBAAT,CAA2BC,UAA3B,EAAuC;;AAEpD,SAAO,SAASC,iBAAT,CAA2BC,aAA3B,EAA0C;;AAE/C,QAAMC,aAAa,eAAKC,OAAL,CAAaJ,UAAb,CAAnB;AACA,QAAMK,kBAAkB,eAAKC,OAAL,CAAcH,UAAd,EAA0B,UAA1B,CAAxB;AACA,QAAMI,gBAAgB,eAAKD,OAAL,CAAcH,UAAd,EAA0B,QAA1B,CAAtB;;AAEA,QAAIK,aAAa;AACfC,aAAO,KADQ;AAEfC,WAAK;AAFU,KAAjB;;AAKA,QAAI;AACFF,iBAAWC,KAAX,GAAmB,aAAGE,SAAH,CAAcN,eAAd,EAAgCO,WAAhC,EAAnB;AACD,KAFD,CAEE,OAAMC,EAAN,EAAU,CAAE;AACd,QAAI;AACFL,iBAAWE,GAAX,GAAiB,aAAGC,SAAH,CAAcJ,aAAd,EAA8BK,WAA9B,EAAjB;AACD,KAFD,CAEE,OAAMC,EAAN,EAAU,CAAE;;AAEdX,kBAAcY,OAAd,CAAsBC,OAAtB,CACE,IAAI,kBAAQC,YAAZ,CAAyB;AACvBC,yCAAmCC,KAAKC,SAAL,CAAenB,UAAf,CADZ;AAEvBoB,8CAAwCF,KAAKC,SAAL,CAAgBhB,UAAhB,CAFjB;AAGvBkB,gDAA0CH,KAAKC,SAAL,CAAeX,WAAWC,KAAX,6CAAf,CAHnB;AAIvBa,8CAAwCJ,KAAKC,SAAL,CAAeX,WAAWE,GAAX,2CAAf;AAJjB,KAAzB,CADF;;AAUA,WAAOR,aAAP;AACD,GA7BD;AA8BD","file":"build.js","sourcesContent":["import webpack from 'webpack';\nimport path from 'path';\nimport fs from 'fs';\n\nexport default function generateBuildImpl(configPath) {\n  \n  return function webpackModifyImpl(webpackConfig) {\n\n    const workingDir = path.dirname(configPath);\n    const jsapiContextDir = path.resolve( workingDir, './jsapi/' );\n    const rpcContextDir = path.resolve( workingDir, './rpc/' );\n\n    let useContext = {\n      jsapi: false,\n      rpc: false\n    };\n\n    try {\n      useContext.jsapi = fs.lstatSync( jsapiContextDir ).isDirectory();\n    } catch(ex) {}\n    try {\n      useContext.rpc = fs.lstatSync( rpcContextDir ).isDirectory();\n    } catch(ex) {}\n\n    webpackConfig.plugins.unshift(\n      new webpack.DefinePlugin({\n        __KYLIN_PLUGIN_LUNA_MOCK_CONFIG__: JSON.stringify(configPath),\n        __KYLIN_PLUGIN_LUNA_MOCK_WORKING_DIR__: JSON.stringify( workingDir ),\n        __KYLIN_PLUGIN_LUNA_MOCK_CONTEXT_JSAPI__: JSON.stringify(useContext.jsapi ? `./context/jsapi.js` : `./context/noop.js`),\n        __KYLIN_PLUGIN_LUNA_MOCK_CONTEXT_RPC__: JSON.stringify(useContext.rpc ? `./context/rpc.js` : `./context/noop.js`),\n        // ...\n      })\n    )\n\n    return webpackConfig;\n  }\n}"]}